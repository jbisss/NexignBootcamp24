package ru.oksana.brtauthautotest;

import io.restassured.RestAssured;
import io.restassured.http.ContentType;
import io.restassured.response.Response;
import org.junit.jupiter.api.Test;
import static io.restassured.RestAssured.given;
import static org.junit.jupiter.api.Assertions.*;

class BrtAuthAutotestApplicationTests {

    final String LINE_BREAK = "\n";

    @Test
    void test1() {
        final String cdrTest = """
                02,79115763555,79215763555,1709798657,1709798657
                01,79215763555,79115763555,1709798657,1709798657
                01,79115763777,79215763555,1709798659,1709798659
                02,79215763555,79115763777,1709798659,1709798659
                02,79115763777,79215763555,1709798657,1709798658
                01,79215763555,79115763777,1709798657,1709798658
                01,79115763555,79215763555,1709798657,1709798657
                02,79215763555,79115763555,1709798657,1709798658
                02,79212131255,79115763777,1709798657,1709798716
                01,79115763777,79212131255,1709798657,1709798716
                01,79015763555,79211233555,1709798657,1709798716
                02,79211233555,79015763555,1709798657,1709798716
                02,79212131155,79312131155,1713899448,1713899508
                01,79312131155,79212131155,1713899448,1713899508""";

        final String expectedResponse = """
                02,79115763555,79215763555,1709798657,1709798657,11
                01,79215763555,79115763555,1709798657,1709798657,12
                02,79215763555,79115763777,1709798659,1709798659,12
                01,79215763555,79115763777,1709798657,1709798658,12
                01,79115763555,79215763555,1709798657,1709798657,11
                02,79215763555,79115763555,1709798657,1709798658,12
                02,79212131255,79115763777,1709798657,1709798716,12
                02,79211233555,79015763555,1709798657,1709798716,12
                02,79212131155,79312131155,1713899448,1713899508,11""";

        RestAssured.baseURI = "http://localhost:52948";
        Response response = given()
                .contentType(ContentType.TEXT)
                .body(cdrTest)
                .when()
                .post("/test/test");
        String responseBody = response.getBody().print();

        response.then()
                .assertThat()
                .statusCode(200);
        String[] responseRows = responseBody.split(LINE_BREAK);
        String[] expectedRows = expectedResponse.split(LINE_BREAK);
        for (int i = 0; i < responseRows.length; i++) {
            assertEquals(expectedRows[i], responseRows[i]);
        }
    }

    @Test
    public void test3() {
        final String cdrTest = """
                02,79115763555,79215763555,1709798657,1709798657
                01,79215763555,79115763555,1709798657,1709798657
                01,79215763555,79051113511,1709798716,1709798716
                02,79051113511,79215763555,1709798716,1709798716
                02,79215233555,79051113611,1713899508,1713899509
                01,79051113611,79215233555,1713899508,1713899509
                01,79213213555,79115763555,1709798716,1709798717
                02,79115763555,79213213555,1709798716,1709798717
                02,79215553555,79041113611,1715415947,1715416006
                01,79041113611,79215553555,1715415947,1715416006
                01,79215433555,79041113811,1715415946,1715416005
                02,79041113811,79215433555,1715415946,1715416005
                02,79212131255,79041113811,1715416005,1715416065
                01,79041113811,79212131255,1715416005,1715416065
                01,79212133555,79215433555,1715416068,1715416128
                02,79215433555,79212133555,1715416068,1715416128
                02,79211233555,79215433555,1715502346,1715503876
                01,79215433555,79211233555,1715502346,1715503876
                01,79212131155,79041113822,1715502346,1715503876
                02,79041113822,79212131155,1715502346,1715503876
                02,79215763555,79041113833,1715503876,1715506816
                01,79041113833,79215763555,1715503876,1715506816
                01,79115763555,79211233555,1715503876,1715506816
                02,79211233555,79115763555,1715503876,1715506816
                02,79115763555,79211233555,1715506816,1715509757
                01,79211233555,79115763555,1715506816,1715509757
                01,79215763555,79041113833,1715506817,1715509758
                02,79041113833,79215763555,1715506817,1715509758
                02,79215763555,79041113833,1715588746,1715591746
                01,79041113833,79215763555,1715588746,1715591746
                01,79213213555,79215433555,1715588746,1715591746
                02,79215433555,79213213555,1715588746,1715591746
                02,79212133555,79212131255,1715588746,1715591747
                01,79212131255,79212133555,1715588746,1715591747
                01,79215233555,79061113833,1715588746,1715591747
                02,79061113833,79215233555,1715588746,1715591747
                """;

        RestAssured.baseURI = "http://localhost:65521";
        Response response = given()
                .contentType(ContentType.TEXT)
                .body(cdrTest)
                .when()
                .post("/test/tariffCustomCdr");
        String responseBody = response.getBody().print();
        response.then()
                .assertThat()
                .statusCode(200);
        assertNotNull(responseBody);
    }
}
